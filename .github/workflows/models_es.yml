name: Empaquetar Coqui con Modelos ES
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Descargar e Inyectar Modelos
        run: |
          docker pull ghcr.io/coqui-ai/tts:latest
          
          # Forzamos el uso de bash ignorando el entrypoint por defecto
          docker run --name tts_prep \
            --entrypoint /bin/bash \
            -e COQUI_TOS_AGREED=1 \
            ghcr.io/coqui-ai/tts:latest \
            -c "tts --model_name tts_models/es/css10/vits --text 'Cargando uno' && \
                tts --model_name tts_models/es/mai/vits --text 'Cargando dos' && \
                tts --model_name tts_models/multilingual/multi-dataset/xtts_v2 --text 'Cargando tres'"
          
          # Guardamos el contenedor con los modelos ya "vividos" en su interior
          docker commit tts_prep tts-es-full
          docker rm tts_prep
          
          # Exportamos para tu USB
          docker save tts-es-full -o coqui_tts_es_completo.tar

      - name: Subir a GitHub
        uses: actions/upload-artifact@v4
        with:
          name: coqui-espanol-completo
          path: coqui_tts_es_completo.tar
          retention-days: 1
          
